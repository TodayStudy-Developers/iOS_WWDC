# Write Swift Macros
- Swift 5.9 (Swift 2023)에서 도입
- 컴파일 타임에 코드를 생성하거나 변환하는 메커니즘
- 코드 재사용성과 효율성을 높이는 도구
- 반복적인 작업을 자동화하고 타입 안전성을 제공하는 기능
- 코드 작성 시 더 나은 가독성과 생산성을 위해 활용
- 다양한 타입과 구조에 대해 동적으로 동작할 수 있음

### **컴파일 타임 코드 생성**
- 컴파일 타임에 실행되어 코드를 변환하거나 생성.
- 런타임 성능에 영향을 미치지 않으면서 코드의 중복을 줄이고 유지보수 간소화.
- **사용 사례**
    - 반복적인 코드를 제거하거나 줄이는 데 사용.
    - 코드를 변환하여 특정 패턴을 따르게 강제.
    - 주석이나 문서화를 자동 생성.
    - 디버깅용 코드를 자동으로 추가.
- **매크로 정의**
    - `#macro` 키워드를 사용
    - 필요한 입력을 받아 처리 후 원하는 코드를 반환.
    - `external` 속성을 통해 Swift 외부의 도구를 호출 가능.

## 형태

### Annotation Macro
- 특정 선언에 annotation을 추가해 동작 확장

```swift
//데이터 모델에서 JSON 디코딩/인코딩 로직 생성
@Codable
struct User {
    let id: Int
    let name: String
}
```

### 코드 변환 Macro
- 특정 코드를 변환하여 새로운 코드 생성

```swift
//디버깅 로깅 추가하는 매크로
#log("Starting computation")
```

### 구현
- SwiftSyntax 라이브러리 사용

```swift
#macro AddTimestamp {
    print("[\(Date())] \($0)")
}

//사용
#AddTimestamp("Hello, World!")

//결과
print("[2024-11-19] Hello, World!")
```

### 장점
- **코드 재사용성 향상**
    - 반복적인 패턴을 줄이고, 코드 중복을 방지.
- **유지보수성 향상**
    - 코드 양을 줄이고 가독성을 높임.
- **런타임 성능 유지**
    - 매크로는 컴파일 타임에 실행되므로 런타임에 영향을 미치지 않음.

### 주의사항
- **복잡성 증가**
    - 매크로를 과도하게 사용하면 코드가 어려워질 수 있음.
- **학습 곡선**
    - SwiftSyntax와 AST를 이해해야 하므로 초기 학습 부담이 있을 수 있음.
- **제한된 지원**
    - 현재 Swift 매크로는 일부 기능에만 적용 가능하며, 추후 확장이 필요함.
